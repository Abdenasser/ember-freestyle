/* global requirejs */
import Ember from 'ember';
import ENV from '../config/environment';

function initialize(container, application) {
  var prefix = ENV.modulePrefix;

  var freestyleModuleRegExp = new RegExp(
    '^' + prefix + '/ember-freestyle'
  );
  var config = {};

  Ember.keys(requirejs._eak_seen).filter(function(key) {
    return freestyleModuleRegExp.test(key);
  }).forEach(function(moduleName) {
    if (moduleName.match('\.jshint')) { // ignore autogenerated .jshint files
      return;
    }

    // var moduleParts = moduleName.split('/');
    // var moduleType = moduleParts[moduleParts.length - 2];
    // var moduleKey = moduleParts[moduleParts.length - 1];
    // Ember.assert('Subdirectories under ' + moduleType + ' are not supported',
    //              moduleParts[moduleParts.length - 3] === 'ember-freestyle');
    // if (moduleType === 'scenario') {
    //   Ember.assert('Only scenario/default.js is supported at this time.',
    //                moduleKey !== 'default');
    // }

    var module = require(moduleName, null, null, true);
    // if (!module) { throw new Error(moduleName + ' must export a ' + moduleType); }

    var data = module['default'];
    config = data['ember-freestyle'];
  });
  application.register('config:ef',
    config,
    { instantiate: false });
  application.inject('service:ember-freestyle',
                     'config',
                     'config:ef');
}

export default {
  name: 'ember-freestyle',
  initialize: initialize
};

