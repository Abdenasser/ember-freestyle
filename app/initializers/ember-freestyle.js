/* global requirejs */
import Ember from 'ember';
import ENV from '../config/environment';

function initialize(container, application) {
  var prefix = ENV.modulePrefix;

  var freestyleModuleRegExp = new RegExp(
    '^' + prefix + '/ember-freestyle'
  );
  var config = {};

  Ember.keys(requirejs._eak_seen).filter(function(key) {
    return freestyleModuleRegExp.test(key);
  }).forEach(function(moduleName) {
    if (moduleName.match('\.jshint')) { // ignore autogenerated .jshint files
      return;
    }

    var module = require(moduleName, null, null, true);
    var data = module['default'];
    config = data['ember-freestyle'];
  });
  application.register('config:ember-freestyle', config, { instantiate: false });
  application.inject('service:ember-freestyle', 'config', 'config:ember-freestyle');
}

export default {
  name: 'ember-freestyle',
  initialize: initialize
};

